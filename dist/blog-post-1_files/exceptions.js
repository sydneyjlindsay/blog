/*! scripts/tumblr/utils/exceptions.js */
(function(v,N){var f=v.document;var D=v.encodeURIComponent;var B=v.navigator;var j=v.parseInt;var s=v.performance;var G=v.window;var E=v.Date;var k=v.Error;var r=v.Math;var K=v.XMLHttpRequest;var M=[];var t=[];var a={};var c=false;function S(V,U,W,T){V.addEventListener?V.addEventListener(U,W,!!T):V.attachEvent&&V.attachEvent("on"+U,W,!!T)}function g(U,T){return(typeof U==="string")&&(U.length>T)?[U.slice(0,T/2),"...",U.length-T,"...",U.slice(-T/2)].join(""):U}function H(X,V){var Y=[];for(var W in X){if(!X.hasOwnProperty(W)){continue}var U=V?(V+"["+W+"]"):W,T=X[W];Y.push(typeof T==="object"?H(T,U):D(U)+"="+D(T))}return Y.join("&")}function p(T){for(var U in T){if(T.hasOwnProperty(U)){return false}}return true}var y=(function(T){return(T&&T.keys)||function(X){var U=[];var W=T.prototype.hasOwnProperty;for(var V in X){W.call(X,V)&&U.push(V)}return U}})(v.Object);var d=function(U,X,V){if(typeof X!=="function"){return}var T=(U&&U.length)>>>0;for(var W=0;W<T;W++){X.call(V,U[W],W,U)}};var R=(function(T){return(T&&T.stringify&&function(V){try{return T.stringify(V)}catch(U){m(U);return'"FAILED_JSON_STRINGIFY"'}})||function(){return'"NO_JSON_STRINGIFY"'}})(v.JSON);var w=(function(T){return(T&&T.Flags)||(function(){m(new k("Missing Tumblr.Flags in exceptions.js"));var U={enable_js_errors_log:true,enable_js_ephemeral_log:true};function V(W,X){return(typeof W==="function")?W.call(this,X):W}return function(X){var W=!!(U[X]);return function Y(aa,ab){var Z=V.call(this,(W?aa:ab),W);return(Z!==void 0)?Z:Y}}})()})(v.Tumblr);function m(U,T){if(typeof T==="number"&&r.random()>T){return}if(U instanceof k){U.url||(U.url="//www.tumblr.com/");n(U.message,U.url,U.ln,U.col,U)}else{M.push(R(U))}}var J=/https?:\/\//;var L=/https?:\/\/[^/]*tumblr[^/]*/;function n(X,U,W,T,V){try{U=g(U,300)||"";if(J.test(U)&&!L.test(U)){return}V=R(g(V&&V.stack,1000)||"");if(J.test(V)&&!L.test(V)){return}t.push({path:(f.location||{}).pathname||"NO_LOCATION_OR_PATHNAME",msg:g(X,200)||"",url:U,ln:j(W,10)||-1,col:j(T,10)||-1,err:V,group:w("js_errors_a")("A",w("js_errors_b")("B","*"))})}catch(V){}}function b(){return((f.head||{}).innerHTML||"").indexOf("#missinge_button")!==-1}var z=m.debugDump=function(){var T=[];d(f.getElementsByTagName("script"),function(U){T.push(U.src)});return{timestamp:+new E(),path:(f.location||{}).href||"NO_HREF",lang:(B||{}).userLanguage||(B||{}).language||"NO_LANG",referrer:f.referrer||"NO_REFERRER",ua:(B||{}).userAgent||"NO_UA",timing:(s||{}).timing||"NO_TIMING",scripts:T,globals:y(v),cookie:f.cookie,ephemeral:M,errors:t,document:(f.documentElement||{}).innerHTML||"NO_DOCUMENT"}};function u(T){var U=z();U.name=T;return R(U)}function A(W){var T=W.length,U,V;while(T>0){V=r.floor(r.random()*T);T--;U=W[T];W[T]=W[V];W[V]=U}return W}function e(Y){if(!s||!s.getEntriesByType){return Y}var U=s.getEntriesByType("resource");var Z={};d(U,function(ab){var aa=(ab.name.match(/\/\/([^/]+)/)||"")[1];if(aa.indexOf(".tumblr.")===-1){return}if(!Z[ab.initiatorType]){Z[ab.initiatorType]=[]}var ac=aa.split(".")[0];Z[ab.initiatorType].push({name:ab.name.split(aa)[1],duration:ab.duration,bucket:ac})});a.entries||(a.entries=[]);var T=[{type:"img",num:10},{type:"link",num:2},{type:"script",num:2},{type:"css",num:2}];for(var X=0;X<T.length;++X){var W=T[X];var V=Z[W.type];if(!V){continue}if(W.num<V.length){A(V)}while(W.num&&V.length){a.entries.push(V.pop());--W.num}}if(y(a)){((Y||(Y={})).perf=a);a.timing=s.timing;a.memory=s.memory;a.navigation=s.navigation}return Y}var h=null;var i=500;var F=1000;var q={};function Q(){var T=v.Tumblr||{};if(!s||!s.getEntriesByName){return}if(T&&T.popUrls){h=T.popUrls;setTimeout(o,i)}}function o(){try{if(!h||!h.length){return}var T=h.pop();if(T){T=T+"?q="+r.random();q[T]={};jQuery.ajax({url:T}).done(function(Y,V,W){var X=s.getEntriesByName(T)[0];if(X){q[T]=X}});setTimeout(o,F)}}catch(U){}}function P(){try{if(!c){t.length=0;m(new k("PAGE_DID_NOT_LOAD"))}var T;!b()&&w("enable_js_errors_log")(function(){t.length&&((T||(T={})).errors=t)});w("js_performance_logging")(function(){try{T=e(T)}catch(X){}});w("enable_js_ephemeral_log")(function(){M.length&&((T||(T={})).ephemeral=M)});w("js_debugger_1")(function(){(T||(T={})).ephemeral=[u("js_debugger_1")]});w("js_debugger_2")(function(){(T||(T={})).ephemeral=[u("js_debugger_2")]});if(!p(q)){(T||(T={})).globalPops=q}if(!T){return}var V=JSON.stringify({form_key:(f.getElementById("tumblr_form_key")||f.body).getAttribute("content"),log:T});var W=new K();W.open("POST","/svc/log/capture/exceptions",false);W.setRequestHeader("Content-type","text/plain");W.onreadystatechange=function(){if(W.readyState!==4){return}t.length=M.length=0};W.send(V)}catch(U){if(!v.jQuery){return}(T||(T={})).errors||(T.errors=t);v.jQuery.ajax({async:false,dataType:"json",contentType:"text/plain",type:"POST",data:{form_key:v.jQuery("#tumblr_form_key").attr("content"),log:T},url:"/svc/log/capture/exceptions",with_form_key:true});m(U)}}(function O(){S(G,"beforeunload",P);G.onerror=n})();(N.Utils||(N.Utils={})).exceptions=m;function l(){a.page_info={};a.page_info.path=f.location.pathname||"n/a"}function C(){var T=new E().getTime();var U=T-s.timing.navigationStart;a.page_load_time=U}function x(){if(!s||!s.timing){return}try{l();C();Q()}catch(T){}}function I(){c=true;x()}S(G,"load",I)})(this,this.Tumblr||(this.Tumblr={}));